# Feature: Shop Upgrades System

## Overview
A permanent upgrade system that allows players to purchase enhancements using scrap. Upgrades are one-time purchases that provide persistent bonuses to gameplay mechanics.

## Currently Implemented Upgrades

### Scrap Efficiency Upgrades
These upgrades increase the amount of scrap generated by AI Pets through a percentage multiplier.

#### 1. Scrap Finder
- **ID**: `scrap-boost-1`
- **Cost**: 100 scrap
- **Effect**: +10% scrap generation from AI Pets
- **Effect Type**: `scrapMultiplier`
- **Effect Value**: 0.1 (10%)
- **Category**: Scrap Efficiency

#### 2. Scrap Magnet
- **ID**: `scrap-boost-2`
- **Cost**: 500 scrap
- **Effect**: +15% scrap generation from AI Pets
- **Effect Type**: `scrapMultiplier`
- **Effect Value**: 0.15 (15%)
- **Category**: Scrap Efficiency

#### 3. Scrap Amplifier
- **ID**: `scrap-boost-3`
- **Cost**: 2000 scrap
- **Effect**: +25% scrap generation from AI Pets
- **Effect Type**: `scrapMultiplier`
- **Effect Value**: 0.25 (25%)
- **Category**: Scrap Efficiency

### Pet Acquisition Upgrades
These upgrades increase the number of AI Pets gained per feed button press.

#### 4. Extra Feed
- **ID**: `pet-boost-1`
- **Cost**: 200 scrap
- **Effect**: +1 AI Pet per feed button press
- **Effect Type**: `petBonus`
- **Effect Value**: 1
- **Category**: Pet Acquisition

#### 5. Double Feed
- **ID**: `pet-boost-2`
- **Cost**: 1000 scrap
- **Effect**: +2 AI Pets per feed button press
- **Effect Type**: `petBonus`
- **Effect Value**: 2
- **Category**: Pet Acquisition

## Technical Implementation

### Data Structure
Upgrades are defined in `frontend/modules/shop/upgradeDefinitions.ts` with the following interface:

```typescript
interface Upgrade {
  id: string;
  name: string;
  description: string;
  cost: number;
  effectType: 'scrapMultiplier' | 'petBonus';
  effectValue: number;
  category?: 'scrapEfficiency' | 'petAcquisition';
}
```

### Persistence
- Purchased upgrade IDs are stored using Legend State with AsyncStorage persistence
- Storage key: `purchased-upgrades-v1`
- Debounce delay: 1000ms

### Purchase Logic
The purchase system (implemented in `useUpgrades` hook) validates:
1. Upgrade exists in definitions
2. Player has sufficient scrap
3. Upgrade hasn't been purchased already

Upon successful purchase:
- Scrap is deducted
- Upgrade ID is added to purchased list
- Upgrade is removed from available upgrades
- Effects are automatically calculated and applied

### Effect Calculation
- **Total Scrap Multiplier**: Sum of all purchased `scrapMultiplier` upgrades
- **Total Pet Bonus**: Sum of all purchased `petBonus` upgrades
- Both values are computed observables that update automatically when purchases occur

## Upgrade Progression

### Scrap Efficiency Path
- **Total possible bonus**: 50% (10% + 15% + 25%)
- **Total cost**: 2,600 scrap
- **Strategy**: Compounds passive scrap generation from AI Pets

### Pet Acquisition Path
- **Total possible bonus**: +3 AI Pets per click
- **Total cost**: 1,200 scrap
- **Strategy**: Accelerates early game progression and AI Pet collection

## Balance Considerations

### Pricing Curve
- Scrap upgrades: 100 → 500 → 2000 (5x, 4x multiplier)
- Pet upgrades: 200 → 1000 (5x multiplier)
- Exponential cost growth encourages strategic purchasing

### Effect Values
- Scrap multipliers increase: 10% → 15% → 25%
- Pet bonuses increase: +1 → +2
- Later upgrades provide better value but require more investment

## Related Files
- **Definitions**: `frontend/modules/shop/upgradeDefinitions.ts:18`
- **Hook Logic**: `frontend/modules/shop/useUpgrades.ts:44`
- **UI Component**: `frontend/modules/shop/UpgradeListItem.tsx`
- **Shop Screen**: `frontend/modules/shop/ShopScreen.tsx`
- **Tests**:
  - `frontend/modules/shop/upgradeDefinitions.test.ts`
  - `frontend/modules/shop/useUpgrades.test.ts`
  - `frontend/modules/shop/UpgradeListItem.test.tsx`
